---
import { siteConfig } from "../config";

const hasProjects = siteConfig.projects && siteConfig.projects.length > 0;
const hasExperience = siteConfig.experience && siteConfig.experience.length > 0;
const hasEducation = siteConfig.education && siteConfig.education.length > 0;

// Create an array of active nav items to calculate delays correctly
const navItems = [
  { name: "About", href: "#about" }
];

if (hasProjects) {
  navItems.push({ name: "Projects", href: "#projects" });
}
if (hasExperience) {
  navItems.push({ name: "Experience", href: "#experience" });
}
if (hasEducation) {
  navItems.push({ name: "Education", href: "#education" });
}
---

<header
  id="header"
  class="fixed top-0 left-0 right-0 z-50 hidden md:block transition-all duration-300"
>
  <nav class="max-w-7xl mx-auto px-8 py-4">
    <ul class="flex items-center gap-8 justify-center">
      {navItems.map((item, index) => {
        const animationDelay = `${index * 100}ms`;
        return (
          <li 
            class="nav-item opacity-0 translate-y-8 transition-all duration-600 ease-out"
            style={`transition-delay: ${animationDelay}`}
          >
            <a
              href={item.href}
              class="text-gray-700 hover:text-black transition-colors font-medium"
            >
              {item.name}
            </a>
          </li>
        );
      })}
    </ul>
  </nav>
</header>

<script>
  // 1. Existing Scroll Logic for Background Blur
  window.addEventListener("scroll", () => {
    const header = document.getElementById("header");
    if (window.scrollY > 100) {
      header?.classList.add("bg-white/80", "backdrop-blur-sm");
    } else {
      header?.classList.remove("bg-white/80", "backdrop-blur-sm");
    }
  });

  // 2. Intersection Observer for Slide-in Animations
  const observerOptions = {
    root: null,
    rootMargin: '0px',
    threshold: 0.1
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        // Element enters view: Show it
        entry.target.classList.remove('opacity-0', 'translate-y-8');
        entry.target.classList.add('opacity-100', 'translate-y-0');
      } else {
        // Element leaves view: Reset to hidden state
        // Note: For a fixed header, this mostly triggers on page reload or if hidden programmatically
        entry.target.classList.remove('opacity-100', 'translate-y-0');
        entry.target.classList.add('opacity-0', 'translate-y-8');
      }
    });
  }, observerOptions);

  // Target all elements with the class 'nav-item'
  document.addEventListener('astro:page-load', () => {
     document.querySelectorAll('.nav-item').forEach((el) => {
      observer.observe(el);
    });
  });

  // Fallback for initial load
  document.querySelectorAll('.nav-item').forEach((el) => {
      observer.observe(el);
  });
</script>

<style>
  html {
    scroll-behavior: smooth;
  }
</style>